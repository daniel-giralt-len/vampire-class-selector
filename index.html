<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="style.css" />
        <title>TRIA EL TEU PERSONATGE - Vampir: l'Emmascarat</title>
    </head>
    <body></body>
    <script type="module">
        import { h, Component, render } from 'https://unpkg.com/preact?module';
        import { useState } from 'https://unpkg.com/preact@latest/hooks/dist/hooks.module.js?module';
        import htm from 'https://unpkg.com/htm?module';
        import clanData from './clan-data.js'
        let clan_index = null


        // Initialize htm with Preact
        const html = htm.bind(h);

        function ClanDisplay({ name, description, image, voiceClip }){
            return html`<div class="clan-display">
                    <div style="grid-area: name">${name}</div>
                    <div style="grid-area: description">${description}</div>
                    <div style="grid-area: image"><img src=${image}/></div>
                </div>`
        }

        function ClansList(props){
            return html`
                <ul class="clan-list">
                    ${props.elements.map(({key, label, image}) => html`
                        <li 
                            aria-label=${label} 
                            class="clan-list-item"
                            onClick=${() => props.onChange(key)}
                        >
                            <button>
                                ${
                                    image
                                        ? html`<img src=${image} />`
                                        : label
                                }
                            </button>
                        </li>
                    `)}
                </ul>`
        }

        class App extends Component {
            state = {selectedClanKey: 'nosferatu'}// null} //TODO: change it back

            selectClan = key => {
                this.setState({selectedClanKey:key})
            }

            render(props, state){
                const listElements = Object
                    .entries(clanData)
                    .map(([key, {name, logo}]) => {
                        return {
                            key: key,
                            label: name,
                            image: logo,
                        }
                    })
    
                const selectedClanData = clanData[state.selectedClanKey]
                const SelectedClanDisplay = selectedClanData
                ? html`<${ClanDisplay}
                    name=${selectedClanData.name}
                    description=${selectedClanData.text}
                    image=${selectedClanData.image}
                    voiceClip=${selectedClanData.voiceClip}
                />` 
                : 'Escull un Clan'
    
                return html`<div class="app-body">
                    ${SelectedClanDisplay}
                    <${ClansList} 
                        elements=${listElements}
                        onChange=${this.selectClan}
                    />
                </div>
                `;
            }
        }

        render(html`<${App}/>`, document.body);
    </script>
</html>